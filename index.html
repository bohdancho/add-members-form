<!DOCTYPE html>
<html>

<head>
	<title>HTML FORM</title>
	<style>
		* {
			margin: 0;
			padding: 0
		}

		body {
			font: 15px sans-serif
		}

		body {
			margin: 30px 30px
		}

		.clear:before,
		.clear:after {
			content: "";
			display: table
		}

		.clear:after {
			clear: both
		}

		input[type="text"],
		input[type="email"],
		select {
			margin-top: 3px;
			box-sizing: border-box;
			height: 30px
		}

		input[type="text"],
		input[type="email"] {
			width: 50%
		}

		.line {
			max-width: 910px
		}

		.line span {
			font-size: 14px;
			color: #333
		}

		.line>div {
			margin-bottom: 20px
		}

		.line div div {
			float: left
		}

		.client {
			background: #eee;
			font-size: 13px;
			color: #333
		}

		.client p {
			margin: 10px 0 0 10px
		}

		.client input {
			min-width: 150px
		}

		.client>div {
			padding: 10px
		}

		.spanlnk {
			border-bottom: 1px dotted blue;
			cursor: pointer
		}

.client-hidden, .btn-hidden {
	display: none;
}
	</style>
	<meta charset="UTF-8">
</head>

<body>

	<form class="line" id="myForm" onsubmit="validateOnSubmit(event)">

		<div>Ваш E-mail:<br /> <input type="email" name="email" placeholder="Ваш E-mail" required="true" /></div>

		<div><b>Участники</b></div>

		<div class="client clear" id="1">
			<div>Имя и фамилия:<br /> <input type="text" name="1[name]" onkeyup="this.value = this.value.toUpperCase();"
					required="true" /></div>
			<div>Пол:<br />
				<select name="1[gender]" required="true">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="1[nationality]" required="true">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--1-->

		<div class="client clear client-hidden" id="2">
			<p><span onclick="delUser(this)" class="spanlnk">2Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="2[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="2[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="2[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--2-->

		<div class="client clear client-hidden" id="3">
			<p><span onclick="delUser(this)" class="spanlnk">3Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="3[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="3[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="3[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--3-->

		<div class="client clear client-hidden" id="4">
			<p><span onclick="delUser(this)" class="spanlnk">4Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="4[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="4[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="4[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--4-->

		<div class="client clear client-hidden" id="5">
			<p><span onclick="delUser(this)" class="spanlnk">5Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="5[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="5[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="5[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--5-->

		<div class="client clear client-hidden" id="6">
			<p><span onclick="delUser(this)" class="spanlnk">6Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="6[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="6[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="6[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--6-->

		<div class="client clear client-hidden" id="7">
			<p><span onclick="delUser(this)" class="spanlnk">7Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="7[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="7[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="7[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--7-->

		<div class="client clear client-hidden" id="8">
			<p><span onclick="delUser(this)" class="spanlnk">8Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="8[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="8[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="8[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--8-->

		<div class="client clear client-hidden" id="9">
			<p><span onclick="delUser(this)" class="spanlnk">9Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="9[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="9[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="9[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--9-->

		<div class="client clear client-hidden" id="10">
			<p><span onclick="delUser(this)" class="spanlnk">10Удалить</span></p>
			<div>Имя и фамилия:<br /> <input type="text" name="10[name]" onkeyup="this.value = this.value.toUpperCase();" />
			</div>
			<div>Пол:<br />
				<select name="10[gender]">
					<option value="">Выбрать</option>
					<option value="Male">Мужской</option>
					<option value="Female">Женский</option>
				</select>
			</div>
			<div>Гражданство: <br />
				<select name="10[nationality]">
					<option value="">Выбрать</option>
					<option value="Russia">Russia</option>
					<option value="Kazakhstan">Kazakhstan</option>
					<option value="Moldova">Moldova</option>
				</select>
			</div>
		</div>
		<!--10-->

		<div><span onclick="addUser()" id="addHuman" class="spanlnk">+ Добавить человека</span></div>

		<input type="submit" name="ok" value="Отправить данные" />

	</form>

	<script>
		function addUser() {
			var addBtn = document.querySelector("#addHuman");			
			var hiddenClients = document.querySelectorAll(".client-hidden");
			var currentClient = hiddenClients[0];
			var currentClientInputs = currentClient.querySelectorAll("input");
			var currentClientSelects = currentClient.querySelectorAll("select");
			
			currentClient.className = currentClient.className.replace(/\bclient-hidden\b/g, "");

			for (var i = 0; i < currentClientInputs.length; i++) {
				currentClientInputs[i].setAttribute("required", "");
			}
			for (var i = 0; i < currentClientSelects.length; i++) {
				currentClientSelects[i].setAttribute("required", "");
			}

			if (hiddenClients.length === 1) {
				addBtn.className += " btn-hidden";
			}
		}

		function delUser(e) {
			var addBtn = document.querySelector("#addHuman");
			var currentClient = e.parentElement.parentElement;
			var currentClientInputs = currentClient.querySelectorAll("input");
			var currentClientSelects = currentClient.querySelectorAll("select");

			for (var i = 0; i < currentClientInputs.length; i++) {
				currentClientInputs[i].removeAttribute("required", "");
				currentClientInputs[i].value = "";
			}
			for (var i = 0; i < currentClientSelects.length; i++) {
				currentClientSelects[i].removeAttribute("required", "");
				currentClientSelects[i].querySelectorAll("option")[0].selected = "selected";
			}
			
			addBtn.className = addBtn.className.replace(/\bbtn-hidden\b/g, "");
			
			currentClient.className += " client-hidden";
		}
	</script>

	<script>
		function validateOnSubmit(event) {
			var currentForm = event.target;
			var requiredInputs = currentForm.querySelectorAll("input[required]");
			var requiredSelects = currentForm.querySelectorAll("select[required]");

			var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			if (!re.test(requiredInputs[0].value)) {
				alert("Введите корректный почтовый адрес");
				event.preventDefault ? event.preventDefault() : (event.returnValue = false);
				return false;
			}

			for (var i = 0; i < requiredInputs.length; i++) {
				if (requiredInputs[i].value == "") {
					var name = requiredInputs[i].name;
					var type = name.substr(1);
					
					console.log(name);
					switch(type) {
						case "mail":
							alert("Не заполнен почтовый адрес");
							break;
						case "[name]":
							alert("Не заполнено имя " + name[0] + " человека");
							break;
						case "0[name]":
							alert("Не заполнено имя " + name[0] + name[1] + " человека");
							break;
					}
					event.preventDefault ? event.preventDefault() : (event.returnValue = false);
					return false;
				}
			}

			for (var i = 0; i < requiredSelects.length; i++) {
				if (requiredSelects[i].selectedIndex === 0) {
					var name = requiredSelects[i].name;
					var type = name.substr(1);
					
					switch(type) {
						case "[gender]":
							alert("Не заполнен пол " + name[0] + " человека");
							break;
						case "[nationality]":
							alert("Не заполнено гражданство " + name[0] + " человека");
							break;
						case "0[gender]":
							alert("Не заполнен пол " + name[0] + name[1] + " человека");
							break;
						case "0[nationality]":
							alert("Не заполнено гражданство " + name[0] + name[1] + " человека");
							break;
					}
					event.preventDefault ? event.preventDefault() : (event.returnValue = false);
					return false;
				}
			}

		}
	</script>

</body>

</html>